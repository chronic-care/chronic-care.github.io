<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableLocators,DisableListDemotion,DisableListPromotion" xsi:type="a:CqlToElmInfo"/>
   <identifier id="CDS_Connect_Commons_for_FHIRv400" system="http://fhir.org/guides/acep" version="1.0.2"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def locator="15:1-15:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1"/>
   </usings>
   <includes>
      <def locator="18:1-18:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1"/>
   </includes>
   <codeSystems>
      <def locator="20:1-20:97" name="AIVERSTATUS" id="http://terminology.hl7.org/CodeSystem/allergyintolerance-verification" accessLevel="Public"/>
      <def locator="21:1-21:94" name="AICLINSTATUS" id="http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical" accessLevel="Public"/>
      <def locator="22:1-22:88" name="CONDVERSTATUS" id="http://terminology.hl7.org/CodeSystem/condition-ver-status" accessLevel="Public"/>
      <def locator="23:1-23:87" name="CONDCLINSTATUS" id="http://terminology.hl7.org/CodeSystem/condition-clinical" accessLevel="Public"/>
   </codeSystems>
   <codes>
      <def locator="24:1-24:92" name="AllergyIntolerance Confirmed code" id="confirmed" display="Confirmed" accessLevel="Public">
         <codeSystem locator="24:60-24:72" name="AIVERSTATUS"/>
      </def>
      <def locator="25:1-25:84" name="AllergyIntolerance Active code" id="active" display="Active" accessLevel="Public">
         <codeSystem locator="25:54-25:67" name="AICLINSTATUS"/>
      </def>
      <def locator="26:1-26:85" name="Condition Confirmed code" id="confirmed" display="Confirmed" accessLevel="Public">
         <codeSystem locator="26:51-26:65" name="CONDVERSTATUS"/>
      </def>
      <def locator="27:1-27:77" name="Condition Active code" id="active" display="Active" accessLevel="Public">
         <codeSystem locator="27:45-27:60" name="CONDCLINSTATUS"/>
      </def>
      <def locator="28:1-28:89" name="Condition Recurrence code" id="recurrence" display="Recurrence" accessLevel="Public">
         <codeSystem locator="28:53-28:68" name="CONDCLINSTATUS"/>
      </def>
      <def locator="29:1-29:80" name="Condition Relapse code" id="relapse" display="Relapse" accessLevel="Public">
         <codeSystem locator="29:47-29:62" name="CONDCLINSTATUS"/>
      </def>
   </codes>
   <statements>
      <def locator="47:1-54:56" name="PeriodToInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="48:3-54:56" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand locator="48:6-48:19" xsi:type="IsNull">
                  <operand locator="48:6-48:11" name="period" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then xsi:type="As">
               <operand locator="49:5-49:8" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </then>
            <else locator="51:5-54:56" xsi:type="If">
               <condition asType="t:Boolean" xsi:type="As">
                  <operand locator="51:8-51:29" xsi:type="IsNull">
                     <operand locator="51:8-51:21" path="start" xsi:type="Property">
                        <source locator="51:8-51:13" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </condition>
               <then locator="52:7-52:56" lowClosed="false" highClosed="true" xsi:type="Interval">
                  <low locator="52:16-52:35" path="value" xsi:type="Property">
                     <source locator="52:16-52:29" path="start" xsi:type="Property">
                        <source locator="52:16-52:21" name="period" xsi:type="OperandRef"/>
                     </source>
                  </low>
                  <high locator="52:38-52:55" path="value" xsi:type="Property">
                     <source locator="52:38-52:49" path="end" xsi:type="Property">
                        <source locator="52:38-52:43" name="period" xsi:type="OperandRef"/>
                     </source>
                  </high>
               </then>
               <else locator="54:7-54:56" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="54:16-54:35" path="value" xsi:type="Property">
                     <source locator="54:16-54:29" path="start" xsi:type="Property">
                        <source locator="54:16-54:21" name="period" xsi:type="OperandRef"/>
                     </source>
                  </low>
                  <high locator="54:38-54:55" path="value" xsi:type="Property">
                     <source locator="54:38-54:49" path="end" xsi:type="Property">
                        <source locator="54:38-54:43" name="period" xsi:type="OperandRef"/>
                     </source>
                  </high>
               </else>
            </else>
         </expression>
         <operand name="period">
            <operandTypeSpecifier locator="47:41-47:51" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="101:1-105:83" name="RangeToInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="102:3-105:83" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand locator="102:6-102:18" xsi:type="IsNull">
                  <operand locator="102:6-102:10" name="range" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then xsi:type="As">
               <operand locator="103:5-103:8" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </then>
            <else locator="105:5-105:83" lowClosed="true" highClosed="true" xsi:type="Interval">
               <low locator="105:14-105:46" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="105:37-105:45" path="low" xsi:type="Property">
                     <source locator="105:37-105:41" name="range" xsi:type="OperandRef"/>
                  </operand>
               </low>
               <high locator="105:49-105:82" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="105:72-105:81" path="high" xsi:type="Property">
                     <source locator="105:72-105:76" name="range" xsi:type="OperandRef"/>
                  </operand>
               </high>
            </else>
         </expression>
         <operand name="range">
            <operandTypeSpecifier locator="101:39-101:48" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="115:1-116:63" name="ObservationsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="116:3-116:63" xsi:type="Query">
            <source locator="116:3-116:17" alias="O">
               <expression locator="116:3-116:15" dataType="fhir:Observation" templateId="http://hl7.org/fhir/StructureDefinition/Observation" xsi:type="Retrieve"/>
            </source>
            <where locator="116:19-116:63" xsi:type="Equivalent">
               <operand locator="116:25-116:53" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="116:47-116:52" path="code" scope="O" xsi:type="Property"/>
               </operand>
               <operand locator="116:57-116:63" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="115:47-115:60" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="125:1-126:69" name="Verified" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="126:3-126:69" xsi:type="Query">
            <source locator="126:3-126:11" alias="O">
               <expression locator="126:3-126:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <where locator="126:13-126:69" xsi:type="In">
               <operand locator="126:19-126:32" path="value" xsi:type="Property">
                  <source locator="126:19-126:26" path="status" scope="O" xsi:type="Property"/>
               </operand>
               <operand locator="126:37-126:69" xsi:type="List">
                  <element locator="126:38-126:44" valueType="t:String" value="final" xsi:type="Literal"/>
                  <element locator="126:47-126:57" valueType="t:String" value="corrected" xsi:type="Literal"/>
                  <element locator="126:60-126:68" valueType="t:String" value="amended" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="125:34-125:50" xsi:type="ListTypeSpecifier">
               <elementType locator="125:39-125:49" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="134:1-136:102" name="WithUnit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="135:3-136:102" xsi:type="Query">
            <source locator="135:3-135:11" alias="O">
               <expression locator="135:3-135:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <where locator="136:5-136:102" xsi:type="Or">
               <operand locator="136:11-136:54" xsi:type="Equal">
                  <operand locator="136:11-136:47" path="value" xsi:type="Property">
                     <source locator="136:11-136:41" path="unit" xsi:type="Property">
                        <source locator="136:11-136:36" strict="false" xsi:type="As">
                           <operand locator="136:12-136:18" path="value" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="136:23-136:35" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </source>
                  </operand>
                  <operand locator="136:51-136:54" name="Unit" xsi:type="OperandRef"/>
               </operand>
               <operand locator="136:59-136:102" xsi:type="Equal">
                  <operand locator="136:59-136:95" path="value" xsi:type="Property">
                     <source locator="136:59-136:89" path="code" xsi:type="Property">
                        <source locator="136:59-136:84" strict="false" xsi:type="As">
                           <operand locator="136:60-136:66" path="value" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="136:71-136:83" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </source>
                  </operand>
                  <operand locator="136:99-136:102" name="Unit" xsi:type="OperandRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="134:34-134:50" xsi:type="ListTypeSpecifier">
               <elementType locator="134:39-134:49" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="Unit">
            <operandTypeSpecifier locator="134:58-134:63" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="146:1-152:43" name="ObservationLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="147:3-152:43" xsi:type="Query">
            <source locator="147:3-147:11" alias="O">
               <expression locator="147:3-147:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <let locator="148:9-148:59" identifier="LookBackInterval">
               <expression locator="148:27-148:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="148:36-148:51" xsi:type="Subtract">
                     <operand locator="148:36-148:40" xsi:type="Now"/>
                     <operand locator="148:44-148:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="148:54-148:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="149:5-152:43" xsi:type="Or">
               <operand locator="149:11-151:79" xsi:type="Or">
                  <operand locator="149:11-150:64" xsi:type="Or">
                     <operand locator="149:11-149:66" xsi:type="In">
                        <operand locator="149:11-149:46" path="value" xsi:type="Property">
                           <source locator="149:11-149:40" strict="false" xsi:type="As">
                              <operand locator="149:12-149:22" path="effective" scope="O" xsi:type="Property"/>
                              <asTypeSpecifier locator="149:27-149:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="149:51-149:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="150:10-150:64" xsi:type="In">
                        <operand locator="150:10-150:44" path="value" xsi:type="Property">
                           <source locator="150:10-150:38" strict="false" xsi:type="As">
                              <operand locator="150:11-150:21" path="effective" scope="O" xsi:type="Property"/>
                              <asTypeSpecifier locator="150:26-150:37" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="150:49-150:64" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="151:10-151:79" xsi:type="Overlaps">
                     <operand locator="151:10-151:53" name="PeriodToInterval" xsi:type="FunctionRef">
                        <operand locator="151:27-151:52" strict="false" xsi:type="As">
                           <operand locator="151:27-151:37" path="effective" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="151:42-151:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </operand>
                     <operand locator="151:64-151:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
               </operand>
               <operand locator="152:10-152:43" xsi:type="In">
                  <operand locator="152:10-152:23" path="value" xsi:type="Property">
                     <source locator="152:10-152:17" path="issued" scope="O" xsi:type="Property"/>
                  </operand>
                  <operand locator="152:28-152:43" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="146:45-146:61" xsi:type="ListTypeSpecifier">
               <elementType locator="146:50-146:60" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="146:73-146:87" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="163:1-170:3" name="MostRecent" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="164:3-170:3" xsi:type="Last">
            <source locator="164:8-169:17" xsi:type="Query">
               <source locator="164:8-164:16" alias="O">
                  <expression locator="164:8-164:14" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <sort locator="164:18-169:17">
                  <by locator="164:26-169:17" direction="asc" xsi:type="ByExpression">
                     <expression locator="164:26-169:17" xsi:type="Coalesce">
                        <operand locator="165:5-165:38" path="value" xsi:type="Property">
                           <source locator="165:5-165:32" strict="false" xsi:type="As">
                              <operand locator="165:6-165:14" name="effective" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="165:19-165:31" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="166:5-166:37" path="value" xsi:type="Property">
                           <source locator="166:5-166:31" strict="false" xsi:type="As">
                              <operand locator="166:6-166:14" name="effective" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="166:19-166:30" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="167:5-167:42" path="value" xsi:type="Property">
                           <source locator="167:5-167:36" path="end" xsi:type="Property">
                              <source locator="167:5-167:30" strict="false" xsi:type="As">
                                 <operand locator="167:6-167:14" name="effective" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="167:19-167:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="168:5-168:44" path="value" xsi:type="Property">
                           <source locator="168:5-168:38" path="start" xsi:type="Property">
                              <source locator="168:5-168:30" strict="false" xsi:type="As">
                                 <operand locator="168:6-168:14" name="effective" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="168:19-168:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="169:5-169:16" path="value" xsi:type="Property">
                           <source locator="169:5-169:10" name="issued" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="163:36-163:52" xsi:type="ListTypeSpecifier">
               <elementType locator="163:41-163:51" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="177:1-183:5" name="QuantityValue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="178:3-183:5" xsi:type="Case">
            <caseItem locator="179:3-179:28">
               <when locator="179:8-179:18" xsi:type="IsNull">
                  <operand locator="179:8-179:10" name="Obs" xsi:type="OperandRef"/>
               </when>
               <then asType="t:Quantity" xsi:type="As">
                  <operand locator="179:25-179:28" xsi:type="Null"/>
               </then>
            </caseItem>
            <caseItem locator="180:3-180:51">
               <when locator="180:8-180:41" xsi:type="IsNull">
                  <operand locator="180:8-180:33" strict="false" xsi:type="As">
                     <operand locator="180:8-180:16" path="value" xsi:type="Property">
                        <source locator="180:8-180:10" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="180:21-180:33" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                  </operand>
               </when>
               <then asType="t:Quantity" xsi:type="As">
                  <operand locator="180:48-180:51" xsi:type="Null"/>
               </then>
            </caseItem>
            <else locator="182:5-182:54" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <operand locator="182:28-182:53" strict="false" xsi:type="As">
                  <operand locator="182:28-182:36" path="value" xsi:type="Property">
                     <source locator="182:28-182:30" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="182:41-182:53" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
               </operand>
            </else>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="177:35-177:45" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="190:1-191:58" name="ConceptValue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="191:3-191:58" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
            <operand locator="191:25-191:57" strict="false" xsi:type="As">
               <operand locator="191:25-191:33" path="value" xsi:type="Property">
                  <source locator="191:25-191:27" name="Obs" xsi:type="OperandRef"/>
               </operand>
               <asTypeSpecifier locator="191:38-191:57" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="190:34-190:44" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="200:1-207:3" name="FindDate" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="201:3-207:3" xsi:type="Coalesce">
            <operand locator="202:5-202:42" path="value" xsi:type="Property">
               <source locator="202:5-202:36" strict="false" xsi:type="As">
                  <operand locator="202:6-202:18" path="effective" xsi:type="Property">
                     <source locator="202:6-202:8" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="202:23-202:35" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
               </source>
            </operand>
            <operand locator="203:5-203:41" path="value" xsi:type="Property">
               <source locator="203:5-203:35" strict="false" xsi:type="As">
                  <operand locator="203:6-203:18" path="effective" xsi:type="Property">
                     <source locator="203:6-203:8" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="203:23-203:34" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
               </source>
            </operand>
            <operand locator="204:5-204:46" path="value" xsi:type="Property">
               <source locator="204:5-204:40" path="end" xsi:type="Property">
                  <source locator="204:5-204:34" strict="false" xsi:type="As">
                     <operand locator="204:6-204:18" path="effective" xsi:type="Property">
                        <source locator="204:6-204:8" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="204:23-204:33" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand locator="205:5-205:48" path="value" xsi:type="Property">
               <source locator="205:5-205:42" path="start" xsi:type="Property">
                  <source locator="205:5-205:34" strict="false" xsi:type="As">
                     <operand locator="205:6-205:18" path="effective" xsi:type="Property">
                        <source locator="205:6-205:8" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="205:23-205:33" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand locator="206:5-206:20" path="value" xsi:type="Property">
               <source locator="206:5-206:14" path="issued" xsi:type="Property">
                  <source locator="206:5-206:7" name="Obs" xsi:type="OperandRef"/>
               </source>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="200:30-200:40" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="215:1-216:72" name="HighestObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="216:3-216:72" xsi:type="Max">
            <source locator="216:7-216:71" xsi:type="Query">
               <source locator="216:7-216:15" alias="O">
                  <expression locator="216:7-216:13" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <return locator="216:17-216:71">
                  <expression locator="216:24-216:71" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="216:47-216:70" strict="false" xsi:type="As">
                        <operand locator="216:47-216:53" path="value" scope="O" xsi:type="Property"/>
                        <asTypeSpecifier locator="216:58-216:70" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="215:44-215:60" xsi:type="ListTypeSpecifier">
               <elementType locator="215:49-215:59" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="224:1-225:72" name="LowestObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="225:3-225:72" xsi:type="Min">
            <source locator="225:7-225:71" xsi:type="Query">
               <source locator="225:7-225:15" alias="O">
                  <expression locator="225:7-225:13" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <return locator="225:17-225:71">
                  <expression locator="225:24-225:71" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="225:47-225:70" strict="false" xsi:type="As">
                        <operand locator="225:47-225:53" path="value" scope="O" xsi:type="Property"/>
                        <asTypeSpecifier locator="225:58-225:70" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="224:43-224:59" xsi:type="ListTypeSpecifier">
               <elementType locator="224:48-224:58" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="236:1-237:61" name="ConditionsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="237:3-237:61" xsi:type="Query">
            <source locator="237:3-237:15" alias="C">
               <expression locator="237:3-237:13" dataType="fhir:Condition" templateId="http://hl7.org/fhir/StructureDefinition/Condition" xsi:type="Retrieve"/>
            </source>
            <where locator="237:17-237:61" xsi:type="Equivalent">
               <operand locator="237:23-237:51" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="237:45-237:50" path="code" scope="C" xsi:type="Property"/>
               </operand>
               <operand locator="237:55-237:61" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="236:45-236:58" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="245:1-246:68" name="Confirmed" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="246:3-246:68" xsi:type="Query">
            <source locator="246:3-246:12" alias="C">
               <expression locator="246:3-246:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="246:14-246:68" xsi:type="Equivalent">
               <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="246:20-246:39" path="verificationStatus" scope="C" xsi:type="Property"/>
               </operand>
               <operand xsi:type="ToConcept">
                  <operand locator="246:43-246:68" name="Condition Confirmed code" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="245:36-245:50" xsi:type="ListTypeSpecifier">
               <elementType locator="245:41-245:49" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="256:1-259:29" name="ActiveCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="257:3-259:29" xsi:type="Query">
            <source locator="257:3-257:12" alias="C">
               <expression locator="257:3-257:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="258:5-259:29" xsi:type="And">
               <operand locator="258:11-258:52" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="258:11-258:26" path="clinicalStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="258:30-258:52" name="Condition Active code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
               <operand locator="259:11-259:29" xsi:type="IsNull">
                  <operand locator="259:11-259:21" path="abatement" scope="C" xsi:type="Property"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="256:42-256:56" xsi:type="ListTypeSpecifier">
               <elementType locator="256:47-256:55" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="269:1-273:52" name="ActiveOrRecurring" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="270:3-273:52" xsi:type="Query">
            <source locator="270:3-270:12" alias="C">
               <expression locator="270:3-270:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="271:5-273:52" xsi:type="Or">
               <operand locator="271:11-272:55" xsi:type="Or">
                  <operand locator="271:11-271:52" xsi:type="Equivalent">
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="271:11-271:26" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand locator="271:30-271:52" name="Condition Active code" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
                  <operand locator="272:10-272:55" xsi:type="Equivalent">
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="272:10-272:25" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand locator="272:29-272:55" name="Condition Recurrence code" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
               </operand>
               <operand locator="273:10-273:52" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="273:10-273:25" path="clinicalStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="273:29-273:52" name="Condition Relapse code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="269:44-269:58" xsi:type="ListTypeSpecifier">
               <elementType locator="269:49-269:57" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="283:1-288:49" name="ConditionLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="284:3-288:49" xsi:type="Query">
            <source locator="284:3-284:12" alias="C">
               <expression locator="284:3-284:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <let locator="285:9-285:59" identifier="LookBackInterval">
               <expression locator="285:27-285:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="285:36-285:51" xsi:type="Subtract">
                     <operand locator="285:36-285:40" xsi:type="Now"/>
                     <operand locator="285:44-285:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="285:54-285:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="286:5-288:49" xsi:type="Or">
               <operand locator="286:11-287:75" xsi:type="Or">
                  <operand locator="286:11-286:62" xsi:type="In">
                     <operand locator="286:11-286:42" path="value" xsi:type="Property">
                        <source locator="286:11-286:36" strict="false" xsi:type="As">
                           <operand locator="286:12-286:18" path="onset" scope="C" xsi:type="Property"/>
                           <asTypeSpecifier locator="286:23-286:35" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </operand>
                     <operand locator="286:47-286:62" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
                  <operand locator="287:10-287:75" xsi:type="Overlaps">
                     <operand locator="287:10-287:49" name="PeriodToInterval" xsi:type="FunctionRef">
                        <operand locator="287:27-287:48" strict="false" xsi:type="As">
                           <operand locator="287:27-287:33" path="onset" scope="C" xsi:type="Property"/>
                           <asTypeSpecifier locator="287:38-287:48" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </operand>
                     <operand locator="287:60-287:75" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
               </operand>
               <operand locator="288:10-288:49" xsi:type="In">
                  <operand locator="288:10-288:29" path="value" xsi:type="Property">
                     <source locator="288:10-288:23" path="recordedDate" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand locator="288:34-288:49" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="283:44-283:58" xsi:type="ListTypeSpecifier">
               <elementType locator="283:49-283:57" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="283:70-283:84" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="297:1-303:3" name="MostRecentCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="298:3-303:3" xsi:type="Last">
            <source locator="298:8-302:23" xsi:type="Query">
               <source locator="298:8-298:17" alias="C">
                  <expression locator="298:8-298:15" name="CondList" xsi:type="OperandRef"/>
               </source>
               <sort locator="298:19-302:23">
                  <by locator="298:27-302:23" direction="asc" xsi:type="ByExpression">
                     <expression locator="298:27-302:23" xsi:type="Coalesce">
                        <operand locator="299:5-299:34" path="value" xsi:type="Property">
                           <source locator="299:5-299:28" strict="false" xsi:type="As">
                              <operand locator="299:6-299:10" name="onset" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="299:15-299:27" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="300:5-300:38" path="value" xsi:type="Property">
                           <source locator="300:5-300:32" path="end" xsi:type="Property">
                              <source locator="300:5-300:26" strict="false" xsi:type="As">
                                 <operand locator="300:6-300:10" name="onset" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="300:15-300:25" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="301:5-301:40" path="value" xsi:type="Property">
                           <source locator="301:5-301:34" path="start" xsi:type="Property">
                              <source locator="301:5-301:26" strict="false" xsi:type="As">
                                 <operand locator="301:6-301:10" name="onset" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="301:15-301:25" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="302:5-302:22" path="value" xsi:type="Property">
                           <source locator="302:5-302:16" name="recordedDate" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="297:46-297:60" xsi:type="ListTypeSpecifier">
               <elementType locator="297:51-297:59" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="313:2-314:62" name="ProceduresByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="314:4-314:62" xsi:type="Query">
            <source locator="314:4-314:16" alias="P">
               <expression locator="314:4-314:14" dataType="fhir:Procedure" templateId="http://hl7.org/fhir/StructureDefinition/Procedure" xsi:type="Retrieve"/>
            </source>
            <where locator="314:18-314:62" xsi:type="Equivalent">
               <operand locator="314:24-314:52" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="314:46-314:51" path="code" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="314:56-314:62" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="313:46-313:59" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="322:1-324:38" name="Completed" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="323:3-324:38" xsi:type="Query">
            <source locator="323:3-323:12" alias="P">
               <expression locator="323:3-323:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="324:5-324:38" xsi:type="Equal">
               <operand locator="324:11-324:24" path="value" xsi:type="Property">
                  <source locator="324:11-324:18" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="324:28-324:38" valueType="t:String" value="completed" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="322:36-322:50" xsi:type="ListTypeSpecifier">
               <elementType locator="322:41-322:49" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="332:1-334:40" name="ProcedureInProgress" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="333:3-334:40" xsi:type="Query">
            <source locator="333:3-333:12" alias="P">
               <expression locator="333:3-333:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="334:5-334:40" xsi:type="Equal">
               <operand locator="334:11-334:24" path="value" xsi:type="Property">
                  <source locator="334:11-334:18" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="334:28-334:40" valueType="t:String" value="in-progress" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="332:46-332:60" xsi:type="ListTypeSpecifier">
               <elementType locator="332:51-332:59" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="343:1-345:92" name="ProcedurePerformance" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="344:3-345:92" xsi:type="Query">
            <source locator="344:3-344:12" alias="P">
               <expression locator="344:3-344:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="345:5-345:92" xsi:type="Not">
               <operand locator="345:15-345:92" xsi:type="In">
                  <operand locator="345:16-345:29" path="value" xsi:type="Property">
                     <source locator="345:16-345:23" path="status" scope="P" xsi:type="Property"/>
                  </operand>
                  <operand locator="345:34-345:91" xsi:type="List">
                     <element locator="345:35-345:47" valueType="t:String" value="preparation" xsi:type="Literal"/>
                     <element locator="345:50-345:59" valueType="t:String" value="not-done" xsi:type="Literal"/>
                     <element locator="345:62-345:79" valueType="t:String" value="entered-in-error" xsi:type="Literal"/>
                     <element locator="345:82-345:90" valueType="t:String" value="unknown" xsi:type="Literal"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="343:47-343:61" xsi:type="ListTypeSpecifier">
               <elementType locator="343:52-343:60" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="356:1-360:79" name="ProcedureLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="357:3-360:79" xsi:type="Query">
            <source locator="357:3-357:12" alias="P">
               <expression locator="357:3-357:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <let locator="358:9-358:59" identifier="LookBackInterval">
               <expression locator="358:27-358:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="358:36-358:51" xsi:type="Subtract">
                     <operand locator="358:36-358:40" xsi:type="Now"/>
                     <operand locator="358:44-358:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="358:54-358:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="359:5-360:79" xsi:type="Or">
               <operand locator="359:11-359:66" xsi:type="In">
                  <operand locator="359:11-359:46" path="value" xsi:type="Property">
                     <source locator="359:11-359:40" strict="false" xsi:type="As">
                        <operand locator="359:12-359:22" path="performed" scope="P" xsi:type="Property"/>
                        <asTypeSpecifier locator="359:27-359:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     </source>
                  </operand>
                  <operand locator="359:51-359:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
               <operand locator="360:10-360:79" xsi:type="Overlaps">
                  <operand locator="360:10-360:53" name="PeriodToInterval" xsi:type="FunctionRef">
                     <operand locator="360:27-360:52" strict="false" xsi:type="As">
                        <operand locator="360:27-360:37" path="performed" scope="P" xsi:type="Property"/>
                        <asTypeSpecifier locator="360:42-360:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </operand>
                  <operand locator="360:64-360:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="356:44-356:58" xsi:type="ListTypeSpecifier">
               <elementType locator="356:49-356:57" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="356:70-356:84" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="369:1-374:3" name="MostRecentProcedure" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="370:3-374:3" xsi:type="Last">
            <source locator="370:8-373:45" xsi:type="Query">
               <source locator="370:8-370:17" alias="P">
                  <expression locator="370:8-370:15" name="ProcList" xsi:type="OperandRef"/>
               </source>
               <sort locator="370:19-373:45">
                  <by locator="370:27-373:45" direction="asc" xsi:type="ByExpression">
                     <expression locator="370:27-373:45" xsi:type="Coalesce">
                        <operand locator="371:5-371:38" path="value" xsi:type="Property">
                           <source locator="371:5-371:32" strict="false" xsi:type="As">
                              <operand locator="371:6-371:14" name="performed" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="371:19-371:31" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="372:5-372:42" path="value" xsi:type="Property">
                           <source locator="372:5-372:36" path="end" xsi:type="Property">
                              <source locator="372:5-372:30" strict="false" xsi:type="As">
                                 <operand locator="372:6-372:14" name="performed" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="372:19-372:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="373:5-373:44" path="value" xsi:type="Property">
                           <source locator="373:5-373:38" path="start" xsi:type="Property">
                              <source locator="373:5-373:30" strict="false" xsi:type="As">
                                 <operand locator="373:6-373:14" name="performed" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="373:19-373:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="369:46-369:60" xsi:type="ListTypeSpecifier">
               <elementType locator="369:51-369:59" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="388:1-390:55" name="ServiceRequestActiveOrCompleted" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="389:3-390:55" xsi:type="Query">
            <source locator="389:3-389:22" alias="S">
               <expression locator="389:3-389:20" name="ServiceRequestList" xsi:type="OperandRef"/>
            </source>
            <where locator="390:5-390:55" xsi:type="In">
               <operand locator="390:11-390:24" path="value" xsi:type="Property">
                  <source locator="390:11-390:18" path="status" scope="S" xsi:type="Property"/>
               </operand>
               <operand locator="390:29-390:55" xsi:type="List">
                  <element locator="390:34-390:41" valueType="t:String" value="active" xsi:type="Literal"/>
                  <element locator="390:44-390:54" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="ServiceRequestList">
            <operandTypeSpecifier locator="388:68-388:87" xsi:type="ListTypeSpecifier">
               <elementType locator="388:73-388:86" name="fhir:ServiceRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="401:1-403:65" name="ServiceRequestLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="402:3-403:65" xsi:type="Query">
            <source locator="402:3-402:22" alias="S">
               <expression locator="402:3-402:20" name="ServiceRequestList" xsi:type="OperandRef"/>
            </source>
            <where locator="403:5-403:65" xsi:type="In">
               <operand locator="403:11-403:28" path="value" xsi:type="Property">
                  <source locator="403:11-403:22" path="authoredOn" scope="S" xsi:type="Property"/>
               </operand>
               <operand locator="403:33-403:65" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="403:42-403:57" xsi:type="Subtract">
                     <operand locator="403:42-403:46" xsi:type="Now"/>
                     <operand locator="403:50-403:57" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="403:60-403:64" xsi:type="Now"/>
               </operand>
            </where>
         </expression>
         <operand name="ServiceRequestList">
            <operandTypeSpecifier locator="401:59-401:78" xsi:type="ListTypeSpecifier">
               <elementType locator="401:64-401:77" name="fhir:ServiceRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="401:90-401:104" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="422:1-423:43" name="ActiveMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="423:3-423:43" xsi:type="Query">
            <source locator="423:3-423:11" alias="M">
               <expression locator="423:3-423:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="423:13-423:43" xsi:type="Equal">
               <operand locator="423:19-423:32" path="value" xsi:type="Property">
                  <source locator="423:19-423:26" path="status" scope="M" xsi:type="Property"/>
               </operand>
               <operand locator="423:36-423:43" valueType="t:String" value="active" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="422:49-422:71" xsi:type="ListTypeSpecifier">
               <elementType locator="422:54-422:70" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="433:1-436:37" name="ActiveOrCompletedMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="434:3-436:37" xsi:type="Query">
            <source locator="434:3-434:11" alias="M">
               <expression locator="434:3-434:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="435:5-436:37" xsi:type="Or">
               <operand locator="435:11-435:35" xsi:type="Equal">
                  <operand locator="435:11-435:24" path="value" xsi:type="Property">
                     <source locator="435:11-435:18" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="435:28-435:35" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand locator="436:10-436:37" xsi:type="Equal">
                  <operand locator="436:10-436:23" path="value" xsi:type="Property">
                     <source locator="436:10-436:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="436:27-436:37" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="433:60-433:82" xsi:type="ListTypeSpecifier">
               <elementType locator="433:65-433:81" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="446:1-450:35" name="ActiveCompletedOrStoppedMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="447:3-450:35" xsi:type="Query">
            <source locator="447:3-447:11" alias="M">
               <expression locator="447:3-447:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="448:5-450:35" xsi:type="Or">
               <operand locator="448:11-449:37" xsi:type="Or">
                  <operand locator="448:11-448:35" xsi:type="Equal">
                     <operand locator="448:11-448:24" path="value" xsi:type="Property">
                        <source locator="448:11-448:18" path="status" scope="M" xsi:type="Property"/>
                     </operand>
                     <operand locator="448:28-448:35" valueType="t:String" value="active" xsi:type="Literal"/>
                  </operand>
                  <operand locator="449:10-449:37" xsi:type="Equal">
                     <operand locator="449:10-449:23" path="value" xsi:type="Property">
                        <source locator="449:10-449:17" path="status" scope="M" xsi:type="Property"/>
                     </operand>
                     <operand locator="449:27-449:37" valueType="t:String" value="completed" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand locator="450:10-450:35" xsi:type="Equal">
                  <operand locator="450:10-450:23" path="value" xsi:type="Property">
                     <source locator="450:10-450:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="450:27-450:35" valueType="t:String" value="stopped" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="446:67-446:89" xsi:type="ListTypeSpecifier">
               <elementType locator="446:72-446:88" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="460:1-463:48" name="MedicationRequestLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="461:3-463:48" xsi:type="Query">
            <source locator="461:3-461:11" alias="M">
               <expression locator="461:3-461:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <let locator="462:9-462:59" identifier="LookBackInterval">
               <expression locator="462:27-462:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="462:36-462:51" xsi:type="Subtract">
                     <operand locator="462:36-462:40" xsi:type="Now"/>
                     <operand locator="462:44-462:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="462:54-462:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="463:5-463:48" xsi:type="In">
               <operand locator="463:11-463:28" path="value" xsi:type="Property">
                  <source locator="463:11-463:22" path="authoredOn" scope="M" xsi:type="Property"/>
               </operand>
               <operand locator="463:33-463:48" name="LookBackInterval" xsi:type="QueryLetRef"/>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="460:51-460:73" xsi:type="ListTypeSpecifier">
               <elementType locator="460:56-460:72" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="460:85-460:99" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="474:1-475:85" name="EncountersByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="475:3-475:85" xsi:type="Query">
            <source locator="475:3-475:15" alias="E">
               <expression locator="475:3-475:13" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/StructureDefinition/Encounter" xsi:type="Retrieve"/>
            </source>
            <where locator="475:17-475:85" xsi:type="Exists">
               <operand locator="475:29-475:85" xsi:type="Query">
                  <source locator="475:31-475:41" alias="ET">
                     <expression locator="475:31-475:38" path="type" scope="E" xsi:type="Property"/>
                  </source>
                  <where locator="475:43-475:83" xsi:type="Equivalent">
                     <operand locator="475:49-475:73" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="475:71-475:72" name="ET" xsi:type="AliasRef"/>
                     </operand>
                     <operand locator="475:77-475:83" name="Koncept" xsi:type="OperandRef"/>
                  </where>
               </operand>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="474:45-474:58" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="483:1-485:40" name="InProgress" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="484:3-485:40" xsi:type="Query">
            <source locator="484:3-484:11" alias="E">
               <expression locator="484:3-484:9" name="EncList" xsi:type="OperandRef"/>
            </source>
            <where locator="485:5-485:40" xsi:type="Equal">
               <operand locator="485:11-485:24" path="value" xsi:type="Property">
                  <source locator="485:11-485:18" path="status" scope="E" xsi:type="Property"/>
               </operand>
               <operand locator="485:28-485:40" valueType="t:String" value="in-progress" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="EncList">
            <operandTypeSpecifier locator="483:36-483:50" xsi:type="ListTypeSpecifier">
               <elementType locator="483:41-483:49" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="495:1-496:70" name="AllergyIntolerancesByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="496:3-496:70" xsi:type="Query">
            <source locator="496:3-496:24" alias="A">
               <expression locator="496:3-496:22" dataType="fhir:AllergyIntolerance" templateId="http://hl7.org/fhir/StructureDefinition/AllergyIntolerance" xsi:type="Retrieve"/>
            </source>
            <where locator="496:26-496:70" xsi:type="Equivalent">
               <operand locator="496:32-496:60" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="496:54-496:59" path="code" scope="A" xsi:type="Property"/>
               </operand>
               <operand locator="496:64-496:70" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="495:54-495:67" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="506:1-509:67" name="ActiveOrConfirmedAllergyIntolerance" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="507:3-509:67" xsi:type="Query">
            <source locator="507:3-507:20" alias="A">
               <expression locator="507:3-507:18" name="AllergyIntolList" xsi:type="OperandRef"/>
            </source>
            <where locator="508:5-509:67" xsi:type="Or">
               <operand locator="508:11-508:61" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="508:11-508:26" path="clinicalStatus" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="508:30-508:61" name="AllergyIntolerance Active code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
               <operand locator="509:10-509:67" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="509:10-509:29" path="verificationStatus" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="509:33-509:67" name="AllergyIntolerance Confirmed code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="AllergyIntolList">
            <operandTypeSpecifier locator="506:70-506:93" xsi:type="ListTypeSpecifier">
               <elementType locator="506:75-506:92" name="fhir:AllergyIntolerance" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="521:1-531:79" name="GoalLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="522:3-531:79" xsi:type="Query">
            <source locator="522:3-522:12" alias="G">
               <expression locator="522:3-522:10" name="GoalList" xsi:type="OperandRef"/>
            </source>
            <let locator="523:9-523:59" identifier="LookBackInterval">
               <expression locator="523:27-523:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="523:36-523:51" xsi:type="Subtract">
                     <operand locator="523:36-523:40" xsi:type="Now"/>
                     <operand locator="523:44-523:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="523:54-523:58" xsi:type="Now"/>
               </expression>
            </let>
            <let locator="524:5-524:43" identifier="StartDate">
               <expression locator="524:16-524:43" path="value" xsi:type="Property">
                  <source locator="524:16-524:37" strict="false" xsi:type="As">
                     <operand locator="524:17-524:23" path="start" scope="G" xsi:type="Property"/>
                     <asTypeSpecifier locator="524:28-524:36" name="fhir:date" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </expression>
            </let>
            <let locator="525:5-525:34" identifier="StatusDate">
               <expression locator="525:17-525:34" path="value" xsi:type="Property">
                  <source locator="525:17-525:28" path="statusDate" scope="G" xsi:type="Property"/>
               </expression>
            </let>
            <let locator="526:5-526:63" identifier="TargetDates">
               <expression locator="526:18-526:63" xsi:type="Query">
                  <source locator="526:18-526:29" alias="T">
                     <expression locator="526:18-526:27" path="target" scope="G" xsi:type="Property"/>
                  </source>
                  <return locator="526:31-526:63">
                     <expression locator="526:38-526:63" path="value" xsi:type="Property">
                        <source locator="526:38-526:57" strict="false" xsi:type="As">
                           <operand locator="526:39-526:43" path="due" scope="T" xsi:type="Property"/>
                           <asTypeSpecifier locator="526:48-526:56" name="fhir:date" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </expression>
                  </return>
               </expression>
            </let>
            <let locator="527:5-527:88" identifier="TargetQuantities">
               <expression locator="527:23-527:88" xsi:type="Query">
                  <source locator="527:23-527:34" alias="T">
                     <expression locator="527:23-527:32" path="target" scope="G" xsi:type="Property"/>
                  </source>
                  <return locator="527:36-527:88">
                     <expression locator="527:43-527:88" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="527:66-527:87" strict="false" xsi:type="As">
                           <operand locator="527:66-527:70" path="due" scope="T" xsi:type="Property"/>
                           <asTypeSpecifier locator="527:75-527:87" name="fhir:Duration" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </expression>
                  </return>
               </expression>
            </let>
            <where locator="528:5-531:79" xsi:type="Or">
               <operand locator="528:11-530:60" xsi:type="Or">
                  <operand locator="528:11-529:39" xsi:type="Or">
                     <operand locator="528:11-528:39" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="528:11-528:19" name="StartDate" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand locator="528:24-528:39" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="529:10-529:39" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="529:10-529:19" name="StatusDate" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand locator="529:24-529:39" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="530:10-530:60" xsi:type="Exists">
                     <operand locator="530:16-530:60" xsi:type="Query">
                        <source locator="530:17-530:30" alias="TD">
                           <expression locator="530:17-530:27" name="TargetDates" xsi:type="QueryLetRef"/>
                        </source>
                        <where locator="530:32-530:59" xsi:type="In">
                           <operand xsi:type="ToDateTime">
                              <operand locator="530:38-530:39" name="TD" xsi:type="AliasRef"/>
                           </operand>
                           <operand locator="530:44-530:59" name="LookBackInterval" xsi:type="QueryLetRef"/>
                        </where>
                     </operand>
                  </operand>
               </operand>
               <operand locator="531:10-531:79" xsi:type="Exists">
                  <operand locator="531:16-531:79" xsi:type="Query">
                     <source locator="531:17-531:35" alias="TQ">
                        <expression locator="531:17-531:32" name="TargetQuantities" xsi:type="QueryLetRef"/>
                     </source>
                     <where locator="531:37-531:78" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="531:43-531:58" xsi:type="Add">
                              <operand locator="531:44-531:52" name="StartDate" xsi:type="QueryLetRef"/>
                              <operand locator="531:56-531:57" name="TQ" xsi:type="AliasRef"/>
                           </operand>
                        </operand>
                        <operand locator="531:63-531:78" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </where>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="GoalList">
            <operandTypeSpecifier locator="521:39-521:48" xsi:type="ListTypeSpecifier">
               <elementType locator="521:44-521:47" name="fhir:Goal" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="521:60-521:74" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
   </statements>
</library>
