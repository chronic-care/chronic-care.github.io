<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableLocators,DisableListDemotion,DisableListPromotion" xsi:type="a:CqlToElmInfo"/>
   <identifier id="CDSConnectCommons" system="http://fhir.org/guides/preventive-care" version="1.0.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def locator="5:1-5:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1"/>
   </usings>
   <includes>
      <def locator="8:1-8:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1"/>
   </includes>
   <codeSystems>
      <def locator="10:1-10:97" name="AIVERSTATUS" id="http://terminology.hl7.org/CodeSystem/allergyintolerance-verification" accessLevel="Public"/>
      <def locator="11:1-11:94" name="AICLINSTATUS" id="http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical" accessLevel="Public"/>
      <def locator="12:1-12:88" name="CONDVERSTATUS" id="http://terminology.hl7.org/CodeSystem/condition-ver-status" accessLevel="Public"/>
      <def locator="13:1-13:87" name="CONDCLINSTATUS" id="http://terminology.hl7.org/CodeSystem/condition-clinical" accessLevel="Public"/>
   </codeSystems>
   <codes>
      <def locator="14:1-14:92" name="AllergyIntolerance Confirmed code" id="confirmed" display="Confirmed" accessLevel="Public">
         <codeSystem locator="14:60-14:72" name="AIVERSTATUS"/>
      </def>
      <def locator="15:1-15:84" name="AllergyIntolerance Active code" id="active" display="Active" accessLevel="Public">
         <codeSystem locator="15:54-15:67" name="AICLINSTATUS"/>
      </def>
      <def locator="16:1-16:85" name="Condition Confirmed code" id="confirmed" display="Confirmed" accessLevel="Public">
         <codeSystem locator="16:51-16:65" name="CONDVERSTATUS"/>
      </def>
      <def locator="17:1-17:77" name="Condition Active code" id="active" display="Active" accessLevel="Public">
         <codeSystem locator="17:45-17:60" name="CONDCLINSTATUS"/>
      </def>
      <def locator="18:1-18:89" name="Condition Recurrence code" id="recurrence" display="Recurrence" accessLevel="Public">
         <codeSystem locator="18:53-18:68" name="CONDCLINSTATUS"/>
      </def>
      <def locator="19:1-19:80" name="Condition Relapse code" id="relapse" display="Relapse" accessLevel="Public">
         <codeSystem locator="19:47-19:62" name="CONDCLINSTATUS"/>
      </def>
   </codes>
   <statements>
      <def locator="31:1-38:56" name="PeriodToInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="32:3-38:56" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand locator="32:6-32:19" xsi:type="IsNull">
                  <operand locator="32:6-32:11" name="period" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then xsi:type="As">
               <operand locator="33:5-33:8" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </then>
            <else locator="35:5-38:56" xsi:type="If">
               <condition asType="t:Boolean" xsi:type="As">
                  <operand locator="35:8-35:29" xsi:type="IsNull">
                     <operand locator="35:8-35:21" path="start" xsi:type="Property">
                        <source locator="35:8-35:13" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </condition>
               <then locator="36:7-36:56" lowClosed="false" highClosed="true" xsi:type="Interval">
                  <low locator="36:16-36:35" path="value" xsi:type="Property">
                     <source locator="36:16-36:29" path="start" xsi:type="Property">
                        <source locator="36:16-36:21" name="period" xsi:type="OperandRef"/>
                     </source>
                  </low>
                  <high locator="36:38-36:55" path="value" xsi:type="Property">
                     <source locator="36:38-36:49" path="end" xsi:type="Property">
                        <source locator="36:38-36:43" name="period" xsi:type="OperandRef"/>
                     </source>
                  </high>
               </then>
               <else locator="38:7-38:56" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="38:16-38:35" path="value" xsi:type="Property">
                     <source locator="38:16-38:29" path="start" xsi:type="Property">
                        <source locator="38:16-38:21" name="period" xsi:type="OperandRef"/>
                     </source>
                  </low>
                  <high locator="38:38-38:55" path="value" xsi:type="Property">
                     <source locator="38:38-38:49" path="end" xsi:type="Property">
                        <source locator="38:38-38:43" name="period" xsi:type="OperandRef"/>
                     </source>
                  </high>
               </else>
            </else>
         </expression>
         <operand name="period">
            <operandTypeSpecifier locator="31:41-31:51" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="85:1-89:83" name="RangeToInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="86:3-89:83" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand locator="86:6-86:18" xsi:type="IsNull">
                  <operand locator="86:6-86:10" name="range" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then xsi:type="As">
               <operand locator="87:5-87:8" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </then>
            <else locator="89:5-89:83" lowClosed="true" highClosed="true" xsi:type="Interval">
               <low locator="89:14-89:46" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="89:37-89:45" path="low" xsi:type="Property">
                     <source locator="89:37-89:41" name="range" xsi:type="OperandRef"/>
                  </operand>
               </low>
               <high locator="89:49-89:82" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="89:72-89:81" path="high" xsi:type="Property">
                     <source locator="89:72-89:76" name="range" xsi:type="OperandRef"/>
                  </operand>
               </high>
            </else>
         </expression>
         <operand name="range">
            <operandTypeSpecifier locator="85:39-85:48" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="99:1-100:63" name="ObservationsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="100:3-100:63" xsi:type="Query">
            <source locator="100:3-100:17" alias="O">
               <expression locator="100:3-100:15" dataType="fhir:Observation" templateId="http://hl7.org/fhir/StructureDefinition/Observation" xsi:type="Retrieve"/>
            </source>
            <where locator="100:19-100:63" xsi:type="Equivalent">
               <operand locator="100:25-100:53" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="100:47-100:52" path="code" scope="O" xsi:type="Property"/>
               </operand>
               <operand locator="100:57-100:63" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="99:47-99:60" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="109:1-110:69" name="Verified" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="110:3-110:69" xsi:type="Query">
            <source locator="110:3-110:11" alias="O">
               <expression locator="110:3-110:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <where locator="110:13-110:69" xsi:type="In">
               <operand locator="110:19-110:32" path="value" xsi:type="Property">
                  <source locator="110:19-110:26" path="status" scope="O" xsi:type="Property"/>
               </operand>
               <operand locator="110:37-110:69" xsi:type="List">
                  <element locator="110:38-110:44" valueType="t:String" value="final" xsi:type="Literal"/>
                  <element locator="110:47-110:57" valueType="t:String" value="corrected" xsi:type="Literal"/>
                  <element locator="110:60-110:68" valueType="t:String" value="amended" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="109:34-109:50" xsi:type="ListTypeSpecifier">
               <elementType locator="109:39-109:49" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="118:1-120:102" name="WithUnit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="119:3-120:102" xsi:type="Query">
            <source locator="119:3-119:11" alias="O">
               <expression locator="119:3-119:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <where locator="120:5-120:102" xsi:type="Or">
               <operand locator="120:11-120:54" xsi:type="Equal">
                  <operand locator="120:11-120:47" path="value" xsi:type="Property">
                     <source locator="120:11-120:41" path="unit" xsi:type="Property">
                        <source locator="120:11-120:36" strict="false" xsi:type="As">
                           <operand locator="120:12-120:18" path="value" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="120:23-120:35" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </source>
                  </operand>
                  <operand locator="120:51-120:54" name="Unit" xsi:type="OperandRef"/>
               </operand>
               <operand locator="120:59-120:102" xsi:type="Equal">
                  <operand locator="120:59-120:95" path="value" xsi:type="Property">
                     <source locator="120:59-120:89" path="code" xsi:type="Property">
                        <source locator="120:59-120:84" strict="false" xsi:type="As">
                           <operand locator="120:60-120:66" path="value" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="120:71-120:83" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </source>
                  </operand>
                  <operand locator="120:99-120:102" name="Unit" xsi:type="OperandRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="118:34-118:50" xsi:type="ListTypeSpecifier">
               <elementType locator="118:39-118:49" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="Unit">
            <operandTypeSpecifier locator="118:58-118:63" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="130:1-136:43" name="ObservationLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="131:3-136:43" xsi:type="Query">
            <source locator="131:3-131:11" alias="O">
               <expression locator="131:3-131:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <let locator="132:9-132:59" identifier="LookBackInterval">
               <expression locator="132:27-132:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="132:36-132:51" xsi:type="Subtract">
                     <operand locator="132:36-132:40" xsi:type="Now"/>
                     <operand locator="132:44-132:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="132:54-132:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="133:5-136:43" xsi:type="Or">
               <operand locator="133:11-135:79" xsi:type="Or">
                  <operand locator="133:11-134:64" xsi:type="Or">
                     <operand locator="133:11-133:66" xsi:type="In">
                        <operand locator="133:11-133:46" path="value" xsi:type="Property">
                           <source locator="133:11-133:40" strict="false" xsi:type="As">
                              <operand locator="133:12-133:22" path="effective" scope="O" xsi:type="Property"/>
                              <asTypeSpecifier locator="133:27-133:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="133:51-133:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="134:10-134:64" xsi:type="In">
                        <operand locator="134:10-134:44" path="value" xsi:type="Property">
                           <source locator="134:10-134:38" strict="false" xsi:type="As">
                              <operand locator="134:11-134:21" path="effective" scope="O" xsi:type="Property"/>
                              <asTypeSpecifier locator="134:26-134:37" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="134:49-134:64" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="135:10-135:79" xsi:type="Overlaps">
                     <operand locator="135:10-135:53" name="PeriodToInterval" xsi:type="FunctionRef">
                        <operand locator="135:27-135:52" strict="false" xsi:type="As">
                           <operand locator="135:27-135:37" path="effective" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="135:42-135:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </operand>
                     <operand locator="135:64-135:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
               </operand>
               <operand locator="136:10-136:43" xsi:type="In">
                  <operand locator="136:10-136:23" path="value" xsi:type="Property">
                     <source locator="136:10-136:17" path="issued" scope="O" xsi:type="Property"/>
                  </operand>
                  <operand locator="136:28-136:43" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="130:45-130:61" xsi:type="ListTypeSpecifier">
               <elementType locator="130:50-130:60" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="130:73-130:87" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="147:1-154:3" name="MostRecent" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="148:3-154:3" xsi:type="Last">
            <source locator="148:8-153:17" xsi:type="Query">
               <source locator="148:8-148:16" alias="O">
                  <expression locator="148:8-148:14" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <sort locator="148:18-153:17">
                  <by locator="148:26-153:17" direction="asc" xsi:type="ByExpression">
                     <expression locator="148:26-153:17" xsi:type="Coalesce">
                        <operand locator="149:5-149:38" path="value" xsi:type="Property">
                           <source locator="149:5-149:32" strict="false" xsi:type="As">
                              <operand locator="149:6-149:14" name="effective" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="149:19-149:31" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="150:5-150:37" path="value" xsi:type="Property">
                           <source locator="150:5-150:31" strict="false" xsi:type="As">
                              <operand locator="150:6-150:14" name="effective" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="150:19-150:30" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="151:5-151:42" path="value" xsi:type="Property">
                           <source locator="151:5-151:36" path="end" xsi:type="Property">
                              <source locator="151:5-151:30" strict="false" xsi:type="As">
                                 <operand locator="151:6-151:14" name="effective" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="151:19-151:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="152:5-152:44" path="value" xsi:type="Property">
                           <source locator="152:5-152:38" path="start" xsi:type="Property">
                              <source locator="152:5-152:30" strict="false" xsi:type="As">
                                 <operand locator="152:6-152:14" name="effective" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="152:19-152:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="153:5-153:16" path="value" xsi:type="Property">
                           <source locator="153:5-153:10" name="issued" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="147:36-147:52" xsi:type="ListTypeSpecifier">
               <elementType locator="147:41-147:51" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="161:1-162:52" name="QuantityValue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="162:3-162:52" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
            <operand locator="162:26-162:51" strict="false" xsi:type="As">
               <operand locator="162:26-162:34" path="value" xsi:type="Property">
                  <source locator="162:26-162:28" name="Obs" xsi:type="OperandRef"/>
               </operand>
               <asTypeSpecifier locator="162:39-162:51" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="161:35-161:45" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="169:1-170:58" name="ConceptValue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="170:3-170:58" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
            <operand locator="170:25-170:57" strict="false" xsi:type="As">
               <operand locator="170:25-170:33" path="value" xsi:type="Property">
                  <source locator="170:25-170:27" name="Obs" xsi:type="OperandRef"/>
               </operand>
               <asTypeSpecifier locator="170:38-170:57" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="169:34-169:44" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="179:1-186:3" name="FindDate" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="180:3-186:3" xsi:type="Coalesce">
            <operand locator="181:5-181:42" path="value" xsi:type="Property">
               <source locator="181:5-181:36" strict="false" xsi:type="As">
                  <operand locator="181:6-181:18" path="effective" xsi:type="Property">
                     <source locator="181:6-181:8" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="181:23-181:35" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
               </source>
            </operand>
            <operand locator="182:5-182:41" path="value" xsi:type="Property">
               <source locator="182:5-182:35" strict="false" xsi:type="As">
                  <operand locator="182:6-182:18" path="effective" xsi:type="Property">
                     <source locator="182:6-182:8" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="182:23-182:34" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
               </source>
            </operand>
            <operand locator="183:5-183:46" path="value" xsi:type="Property">
               <source locator="183:5-183:40" path="end" xsi:type="Property">
                  <source locator="183:5-183:34" strict="false" xsi:type="As">
                     <operand locator="183:6-183:18" path="effective" xsi:type="Property">
                        <source locator="183:6-183:8" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="183:23-183:33" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand locator="184:5-184:48" path="value" xsi:type="Property">
               <source locator="184:5-184:42" path="start" xsi:type="Property">
                  <source locator="184:5-184:34" strict="false" xsi:type="As">
                     <operand locator="184:6-184:18" path="effective" xsi:type="Property">
                        <source locator="184:6-184:8" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="184:23-184:33" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand locator="185:5-185:20" path="value" xsi:type="Property">
               <source locator="185:5-185:14" path="issued" xsi:type="Property">
                  <source locator="185:5-185:7" name="Obs" xsi:type="OperandRef"/>
               </source>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="179:30-179:40" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="194:1-195:72" name="HighestObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="195:3-195:72" xsi:type="Max">
            <source locator="195:7-195:71" xsi:type="Query">
               <source locator="195:7-195:15" alias="O">
                  <expression locator="195:7-195:13" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <return locator="195:17-195:71">
                  <expression locator="195:24-195:71" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="195:47-195:70" strict="false" xsi:type="As">
                        <operand locator="195:47-195:53" path="value" scope="O" xsi:type="Property"/>
                        <asTypeSpecifier locator="195:58-195:70" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="194:44-194:60" xsi:type="ListTypeSpecifier">
               <elementType locator="194:49-194:59" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="203:1-204:72" name="LowestObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="204:3-204:72" xsi:type="Min">
            <source locator="204:7-204:71" xsi:type="Query">
               <source locator="204:7-204:15" alias="O">
                  <expression locator="204:7-204:13" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <return locator="204:17-204:71">
                  <expression locator="204:24-204:71" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="204:47-204:70" strict="false" xsi:type="As">
                        <operand locator="204:47-204:53" path="value" scope="O" xsi:type="Property"/>
                        <asTypeSpecifier locator="204:58-204:70" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="203:43-203:59" xsi:type="ListTypeSpecifier">
               <elementType locator="203:48-203:58" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="215:1-216:61" name="ConditionsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="216:3-216:61" xsi:type="Query">
            <source locator="216:3-216:15" alias="C">
               <expression locator="216:3-216:13" dataType="fhir:Condition" templateId="http://hl7.org/fhir/StructureDefinition/Condition" xsi:type="Retrieve"/>
            </source>
            <where locator="216:17-216:61" xsi:type="Equivalent">
               <operand locator="216:23-216:51" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="216:45-216:50" path="code" scope="C" xsi:type="Property"/>
               </operand>
               <operand locator="216:55-216:61" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="215:45-215:58" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="224:1-225:68" name="Confirmed" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="225:3-225:68" xsi:type="Query">
            <source locator="225:3-225:12" alias="C">
               <expression locator="225:3-225:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="225:14-225:68" xsi:type="Equivalent">
               <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="225:20-225:39" path="verificationStatus" scope="C" xsi:type="Property"/>
               </operand>
               <operand xsi:type="ToConcept">
                  <operand locator="225:43-225:68" name="Condition Confirmed code" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="224:36-224:50" xsi:type="ListTypeSpecifier">
               <elementType locator="224:41-224:49" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="235:1-238:29" name="ActiveCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="236:3-238:29" xsi:type="Query">
            <source locator="236:3-236:12" alias="C">
               <expression locator="236:3-236:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="237:5-238:29" xsi:type="And">
               <operand locator="237:11-237:52" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="237:11-237:26" path="clinicalStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="237:30-237:52" name="Condition Active code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
               <operand locator="238:11-238:29" xsi:type="IsNull">
                  <operand locator="238:11-238:21" path="abatement" scope="C" xsi:type="Property"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="235:42-235:56" xsi:type="ListTypeSpecifier">
               <elementType locator="235:47-235:55" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="248:1-252:52" name="ActiveOrRecurring" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="249:3-252:52" xsi:type="Query">
            <source locator="249:3-249:12" alias="C">
               <expression locator="249:3-249:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="250:5-252:52" xsi:type="Or">
               <operand locator="250:11-251:55" xsi:type="Or">
                  <operand locator="250:11-250:52" xsi:type="Equivalent">
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="250:11-250:26" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand locator="250:30-250:52" name="Condition Active code" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
                  <operand locator="251:10-251:55" xsi:type="Equivalent">
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="251:10-251:25" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand locator="251:29-251:55" name="Condition Recurrence code" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
               </operand>
               <operand locator="252:10-252:52" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="252:10-252:25" path="clinicalStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="252:29-252:52" name="Condition Relapse code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="248:44-248:58" xsi:type="ListTypeSpecifier">
               <elementType locator="248:49-248:57" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="262:1-267:49" name="ConditionLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="263:3-267:49" xsi:type="Query">
            <source locator="263:3-263:12" alias="C">
               <expression locator="263:3-263:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <let locator="264:9-264:59" identifier="LookBackInterval">
               <expression locator="264:27-264:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="264:36-264:51" xsi:type="Subtract">
                     <operand locator="264:36-264:40" xsi:type="Now"/>
                     <operand locator="264:44-264:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="264:54-264:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="265:5-267:49" xsi:type="Or">
               <operand locator="265:11-266:75" xsi:type="Or">
                  <operand locator="265:11-265:62" xsi:type="In">
                     <operand locator="265:11-265:42" path="value" xsi:type="Property">
                        <source locator="265:11-265:36" strict="false" xsi:type="As">
                           <operand locator="265:12-265:18" path="onset" scope="C" xsi:type="Property"/>
                           <asTypeSpecifier locator="265:23-265:35" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </operand>
                     <operand locator="265:47-265:62" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
                  <operand locator="266:10-266:75" xsi:type="Overlaps">
                     <operand locator="266:10-266:49" name="PeriodToInterval" xsi:type="FunctionRef">
                        <operand locator="266:27-266:48" strict="false" xsi:type="As">
                           <operand locator="266:27-266:33" path="onset" scope="C" xsi:type="Property"/>
                           <asTypeSpecifier locator="266:38-266:48" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </operand>
                     <operand locator="266:60-266:75" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
               </operand>
               <operand locator="267:10-267:49" xsi:type="In">
                  <operand locator="267:10-267:29" path="value" xsi:type="Property">
                     <source locator="267:10-267:23" path="recordedDate" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand locator="267:34-267:49" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="262:44-262:58" xsi:type="ListTypeSpecifier">
               <elementType locator="262:49-262:57" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="262:70-262:84" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="276:1-282:3" name="MostRecentCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="277:3-282:3" xsi:type="Last">
            <source locator="277:8-281:23" xsi:type="Query">
               <source locator="277:8-277:17" alias="C">
                  <expression locator="277:8-277:15" name="CondList" xsi:type="OperandRef"/>
               </source>
               <sort locator="277:19-281:23">
                  <by locator="277:27-281:23" direction="asc" xsi:type="ByExpression">
                     <expression locator="277:27-281:23" xsi:type="Coalesce">
                        <operand locator="278:5-278:34" path="value" xsi:type="Property">
                           <source locator="278:5-278:28" strict="false" xsi:type="As">
                              <operand locator="278:6-278:10" name="onset" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="278:15-278:27" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="279:5-279:38" path="value" xsi:type="Property">
                           <source locator="279:5-279:32" path="end" xsi:type="Property">
                              <source locator="279:5-279:26" strict="false" xsi:type="As">
                                 <operand locator="279:6-279:10" name="onset" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="279:15-279:25" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="280:5-280:40" path="value" xsi:type="Property">
                           <source locator="280:5-280:34" path="start" xsi:type="Property">
                              <source locator="280:5-280:26" strict="false" xsi:type="As">
                                 <operand locator="280:6-280:10" name="onset" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="280:15-280:25" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="281:5-281:22" path="value" xsi:type="Property">
                           <source locator="281:5-281:16" name="recordedDate" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="276:46-276:60" xsi:type="ListTypeSpecifier">
               <elementType locator="276:51-276:59" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="292:2-293:62" name="ProceduresByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="293:4-293:62" xsi:type="Query">
            <source locator="293:4-293:16" alias="P">
               <expression locator="293:4-293:14" dataType="fhir:Procedure" templateId="http://hl7.org/fhir/StructureDefinition/Procedure" xsi:type="Retrieve"/>
            </source>
            <where locator="293:18-293:62" xsi:type="Equivalent">
               <operand locator="293:24-293:52" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="293:46-293:51" path="code" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="293:56-293:62" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="292:46-292:59" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="301:1-303:38" name="Completed" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="302:3-303:38" xsi:type="Query">
            <source locator="302:3-302:12" alias="P">
               <expression locator="302:3-302:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="303:5-303:38" xsi:type="Equal">
               <operand locator="303:11-303:24" path="value" xsi:type="Property">
                  <source locator="303:11-303:18" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="303:28-303:38" valueType="t:String" value="completed" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="301:36-301:50" xsi:type="ListTypeSpecifier">
               <elementType locator="301:41-301:49" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="311:1-313:40" name="ProcedureInProgress" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="312:3-313:40" xsi:type="Query">
            <source locator="312:3-312:12" alias="P">
               <expression locator="312:3-312:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="313:5-313:40" xsi:type="Equal">
               <operand locator="313:11-313:24" path="value" xsi:type="Property">
                  <source locator="313:11-313:18" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="313:28-313:40" valueType="t:String" value="in-progress" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="311:46-311:60" xsi:type="ListTypeSpecifier">
               <elementType locator="311:51-311:59" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="322:1-324:92" name="ProcedurePerformance" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="323:3-324:92" xsi:type="Query">
            <source locator="323:3-323:12" alias="P">
               <expression locator="323:3-323:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="324:5-324:92" xsi:type="Not">
               <operand locator="324:15-324:92" xsi:type="In">
                  <operand locator="324:16-324:29" path="value" xsi:type="Property">
                     <source locator="324:16-324:23" path="status" scope="P" xsi:type="Property"/>
                  </operand>
                  <operand locator="324:34-324:91" xsi:type="List">
                     <element locator="324:35-324:47" valueType="t:String" value="preparation" xsi:type="Literal"/>
                     <element locator="324:50-324:59" valueType="t:String" value="not-done" xsi:type="Literal"/>
                     <element locator="324:62-324:79" valueType="t:String" value="entered-in-error" xsi:type="Literal"/>
                     <element locator="324:82-324:90" valueType="t:String" value="unknown" xsi:type="Literal"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="322:47-322:61" xsi:type="ListTypeSpecifier">
               <elementType locator="322:52-322:60" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="335:1-339:79" name="ProcedureLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="336:3-339:79" xsi:type="Query">
            <source locator="336:3-336:12" alias="P">
               <expression locator="336:3-336:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <let locator="337:9-337:59" identifier="LookBackInterval">
               <expression locator="337:27-337:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="337:36-337:51" xsi:type="Subtract">
                     <operand locator="337:36-337:40" xsi:type="Now"/>
                     <operand locator="337:44-337:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="337:54-337:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="338:5-339:79" xsi:type="Or">
               <operand locator="338:11-338:66" xsi:type="In">
                  <operand locator="338:11-338:46" path="value" xsi:type="Property">
                     <source locator="338:11-338:40" strict="false" xsi:type="As">
                        <operand locator="338:12-338:22" path="performed" scope="P" xsi:type="Property"/>
                        <asTypeSpecifier locator="338:27-338:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     </source>
                  </operand>
                  <operand locator="338:51-338:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
               <operand locator="339:10-339:79" xsi:type="Overlaps">
                  <operand locator="339:10-339:53" name="PeriodToInterval" xsi:type="FunctionRef">
                     <operand locator="339:27-339:52" strict="false" xsi:type="As">
                        <operand locator="339:27-339:37" path="performed" scope="P" xsi:type="Property"/>
                        <asTypeSpecifier locator="339:42-339:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </operand>
                  <operand locator="339:64-339:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="335:44-335:58" xsi:type="ListTypeSpecifier">
               <elementType locator="335:49-335:57" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="335:70-335:84" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="348:1-353:3" name="MostRecentProcedure" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="349:3-353:3" xsi:type="Last">
            <source locator="349:8-352:45" xsi:type="Query">
               <source locator="349:8-349:17" alias="P">
                  <expression locator="349:8-349:15" name="ProcList" xsi:type="OperandRef"/>
               </source>
               <sort locator="349:19-352:45">
                  <by locator="349:27-352:45" direction="asc" xsi:type="ByExpression">
                     <expression locator="349:27-352:45" xsi:type="Coalesce">
                        <operand locator="350:5-350:38" path="value" xsi:type="Property">
                           <source locator="350:5-350:32" strict="false" xsi:type="As">
                              <operand locator="350:6-350:14" name="performed" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="350:19-350:31" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="351:5-351:42" path="value" xsi:type="Property">
                           <source locator="351:5-351:36" path="end" xsi:type="Property">
                              <source locator="351:5-351:30" strict="false" xsi:type="As">
                                 <operand locator="351:6-351:14" name="performed" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="351:19-351:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="352:5-352:44" path="value" xsi:type="Property">
                           <source locator="352:5-352:38" path="start" xsi:type="Property">
                              <source locator="352:5-352:30" strict="false" xsi:type="As">
                                 <operand locator="352:6-352:14" name="performed" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="352:19-352:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="348:46-348:60" xsi:type="ListTypeSpecifier">
               <elementType locator="348:51-348:59" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="365:1-367:55" name="ServiceRequestActiveOrCompleted" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="366:3-367:55" xsi:type="Query">
            <source locator="366:3-366:22" alias="S">
               <expression locator="366:3-366:20" name="ServiceRequestList" xsi:type="OperandRef"/>
            </source>
            <where locator="367:5-367:55" xsi:type="In">
               <operand locator="367:11-367:24" path="value" xsi:type="Property">
                  <source locator="367:11-367:18" path="status" scope="S" xsi:type="Property"/>
               </operand>
               <operand locator="367:29-367:55" xsi:type="List">
                  <element locator="367:34-367:41" valueType="t:String" value="active" xsi:type="Literal"/>
                  <element locator="367:44-367:54" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="ServiceRequestList">
            <operandTypeSpecifier locator="365:68-365:87" xsi:type="ListTypeSpecifier">
               <elementType locator="365:73-365:86" name="fhir:ServiceRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="378:1-380:65" name="ServiceRequestLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="379:3-380:65" xsi:type="Query">
            <source locator="379:3-379:22" alias="S">
               <expression locator="379:3-379:20" name="ServiceRequestList" xsi:type="OperandRef"/>
            </source>
            <where locator="380:5-380:65" xsi:type="In">
               <operand locator="380:11-380:28" path="value" xsi:type="Property">
                  <source locator="380:11-380:22" path="authoredOn" scope="S" xsi:type="Property"/>
               </operand>
               <operand locator="380:33-380:65" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="380:42-380:57" xsi:type="Subtract">
                     <operand locator="380:42-380:46" xsi:type="Now"/>
                     <operand locator="380:50-380:57" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="380:60-380:64" xsi:type="Now"/>
               </operand>
            </where>
         </expression>
         <operand name="ServiceRequestList">
            <operandTypeSpecifier locator="378:59-378:78" xsi:type="ListTypeSpecifier">
               <elementType locator="378:64-378:77" name="fhir:ServiceRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="378:90-378:104" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="399:1-400:43" name="ActiveMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="400:3-400:43" xsi:type="Query">
            <source locator="400:3-400:11" alias="M">
               <expression locator="400:3-400:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="400:13-400:43" xsi:type="Equal">
               <operand locator="400:19-400:32" path="value" xsi:type="Property">
                  <source locator="400:19-400:26" path="status" scope="M" xsi:type="Property"/>
               </operand>
               <operand locator="400:36-400:43" valueType="t:String" value="active" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="399:49-399:71" xsi:type="ListTypeSpecifier">
               <elementType locator="399:54-399:70" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="410:1-413:37" name="ActiveOrCompletedMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="411:3-413:37" xsi:type="Query">
            <source locator="411:3-411:11" alias="M">
               <expression locator="411:3-411:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="412:5-413:37" xsi:type="Or">
               <operand locator="412:11-412:35" xsi:type="Equal">
                  <operand locator="412:11-412:24" path="value" xsi:type="Property">
                     <source locator="412:11-412:18" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="412:28-412:35" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand locator="413:10-413:37" xsi:type="Equal">
                  <operand locator="413:10-413:23" path="value" xsi:type="Property">
                     <source locator="413:10-413:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="413:27-413:37" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="410:60-410:82" xsi:type="ListTypeSpecifier">
               <elementType locator="410:65-410:81" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="423:1-427:35" name="ActiveCompletedOrStoppedMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="424:3-427:35" xsi:type="Query">
            <source locator="424:3-424:11" alias="M">
               <expression locator="424:3-424:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="425:5-427:35" xsi:type="Or">
               <operand locator="425:11-426:37" xsi:type="Or">
                  <operand locator="425:11-425:35" xsi:type="Equal">
                     <operand locator="425:11-425:24" path="value" xsi:type="Property">
                        <source locator="425:11-425:18" path="status" scope="M" xsi:type="Property"/>
                     </operand>
                     <operand locator="425:28-425:35" valueType="t:String" value="active" xsi:type="Literal"/>
                  </operand>
                  <operand locator="426:10-426:37" xsi:type="Equal">
                     <operand locator="426:10-426:23" path="value" xsi:type="Property">
                        <source locator="426:10-426:17" path="status" scope="M" xsi:type="Property"/>
                     </operand>
                     <operand locator="426:27-426:37" valueType="t:String" value="completed" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand locator="427:10-427:35" xsi:type="Equal">
                  <operand locator="427:10-427:23" path="value" xsi:type="Property">
                     <source locator="427:10-427:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="427:27-427:35" valueType="t:String" value="stopped" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="423:67-423:89" xsi:type="ListTypeSpecifier">
               <elementType locator="423:72-423:88" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="437:1-440:48" name="MedicationRequestLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="438:3-440:48" xsi:type="Query">
            <source locator="438:3-438:11" alias="M">
               <expression locator="438:3-438:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <let locator="439:9-439:59" identifier="LookBackInterval">
               <expression locator="439:27-439:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="439:36-439:51" xsi:type="Subtract">
                     <operand locator="439:36-439:40" xsi:type="Now"/>
                     <operand locator="439:44-439:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="439:54-439:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="440:5-440:48" xsi:type="In">
               <operand locator="440:11-440:28" path="value" xsi:type="Property">
                  <source locator="440:11-440:22" path="authoredOn" scope="M" xsi:type="Property"/>
               </operand>
               <operand locator="440:33-440:48" name="LookBackInterval" xsi:type="QueryLetRef"/>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="437:51-437:73" xsi:type="ListTypeSpecifier">
               <elementType locator="437:56-437:72" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="437:85-437:99" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="451:1-452:85" name="EncountersByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="452:3-452:85" xsi:type="Query">
            <source locator="452:3-452:15" alias="E">
               <expression locator="452:3-452:13" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/StructureDefinition/Encounter" xsi:type="Retrieve"/>
            </source>
            <where locator="452:17-452:85" xsi:type="Exists">
               <operand locator="452:29-452:85" xsi:type="Query">
                  <source locator="452:31-452:41" alias="ET">
                     <expression locator="452:31-452:38" path="type" scope="E" xsi:type="Property"/>
                  </source>
                  <where locator="452:43-452:83" xsi:type="Equivalent">
                     <operand locator="452:49-452:73" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="452:71-452:72" name="ET" xsi:type="AliasRef"/>
                     </operand>
                     <operand locator="452:77-452:83" name="Koncept" xsi:type="OperandRef"/>
                  </where>
               </operand>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="451:45-451:58" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="460:1-462:40" name="InProgress" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="461:3-462:40" xsi:type="Query">
            <source locator="461:3-461:11" alias="E">
               <expression locator="461:3-461:9" name="EncList" xsi:type="OperandRef"/>
            </source>
            <where locator="462:5-462:40" xsi:type="Equal">
               <operand locator="462:11-462:24" path="value" xsi:type="Property">
                  <source locator="462:11-462:18" path="status" scope="E" xsi:type="Property"/>
               </operand>
               <operand locator="462:28-462:40" valueType="t:String" value="in-progress" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="EncList">
            <operandTypeSpecifier locator="460:36-460:50" xsi:type="ListTypeSpecifier">
               <elementType locator="460:41-460:49" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="472:1-473:70" name="AllergyIntolerancesByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="473:3-473:70" xsi:type="Query">
            <source locator="473:3-473:24" alias="A">
               <expression locator="473:3-473:22" dataType="fhir:AllergyIntolerance" templateId="http://hl7.org/fhir/StructureDefinition/AllergyIntolerance" xsi:type="Retrieve"/>
            </source>
            <where locator="473:26-473:70" xsi:type="Equivalent">
               <operand locator="473:32-473:60" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="473:54-473:59" path="code" scope="A" xsi:type="Property"/>
               </operand>
               <operand locator="473:64-473:70" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="472:54-472:67" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="483:1-486:67" name="ActiveOrConfirmedAllergyIntolerance" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="484:3-486:67" xsi:type="Query">
            <source locator="484:3-484:20" alias="A">
               <expression locator="484:3-484:18" name="AllergyIntolList" xsi:type="OperandRef"/>
            </source>
            <where locator="485:5-486:67" xsi:type="Or">
               <operand locator="485:11-485:61" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="485:11-485:26" path="clinicalStatus" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="485:30-485:61" name="AllergyIntolerance Active code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
               <operand locator="486:10-486:67" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="486:10-486:29" path="verificationStatus" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="486:33-486:67" name="AllergyIntolerance Confirmed code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="AllergyIntolList">
            <operandTypeSpecifier locator="483:70-483:93" xsi:type="ListTypeSpecifier">
               <elementType locator="483:75-483:92" name="fhir:AllergyIntolerance" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="498:1-508:79" name="GoalLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="499:3-508:79" xsi:type="Query">
            <source locator="499:3-499:12" alias="G">
               <expression locator="499:3-499:10" name="GoalList" xsi:type="OperandRef"/>
            </source>
            <let locator="500:9-500:59" identifier="LookBackInterval">
               <expression locator="500:27-500:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="500:36-500:51" xsi:type="Subtract">
                     <operand locator="500:36-500:40" xsi:type="Now"/>
                     <operand locator="500:44-500:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="500:54-500:58" xsi:type="Now"/>
               </expression>
            </let>
            <let locator="501:5-501:43" identifier="StartDate">
               <expression locator="501:16-501:43" path="value" xsi:type="Property">
                  <source locator="501:16-501:37" strict="false" xsi:type="As">
                     <operand locator="501:17-501:23" path="start" scope="G" xsi:type="Property"/>
                     <asTypeSpecifier locator="501:28-501:36" name="fhir:date" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </expression>
            </let>
            <let locator="502:5-502:34" identifier="StatusDate">
               <expression locator="502:17-502:34" path="value" xsi:type="Property">
                  <source locator="502:17-502:28" path="statusDate" scope="G" xsi:type="Property"/>
               </expression>
            </let>
            <let locator="503:5-503:63" identifier="TargetDates">
               <expression locator="503:18-503:63" xsi:type="Query">
                  <source locator="503:18-503:29" alias="T">
                     <expression locator="503:18-503:27" path="target" scope="G" xsi:type="Property"/>
                  </source>
                  <return locator="503:31-503:63">
                     <expression locator="503:38-503:63" path="value" xsi:type="Property">
                        <source locator="503:38-503:57" strict="false" xsi:type="As">
                           <operand locator="503:39-503:43" path="due" scope="T" xsi:type="Property"/>
                           <asTypeSpecifier locator="503:48-503:56" name="fhir:date" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </expression>
                  </return>
               </expression>
            </let>
            <let locator="504:5-504:88" identifier="TargetQuantities">
               <expression locator="504:23-504:88" xsi:type="Query">
                  <source locator="504:23-504:34" alias="T">
                     <expression locator="504:23-504:32" path="target" scope="G" xsi:type="Property"/>
                  </source>
                  <return locator="504:36-504:88">
                     <expression locator="504:43-504:88" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="504:66-504:87" strict="false" xsi:type="As">
                           <operand locator="504:66-504:70" path="due" scope="T" xsi:type="Property"/>
                           <asTypeSpecifier locator="504:75-504:87" name="fhir:Duration" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </expression>
                  </return>
               </expression>
            </let>
            <where locator="505:5-508:79" xsi:type="Or">
               <operand locator="505:11-507:60" xsi:type="Or">
                  <operand locator="505:11-506:39" xsi:type="Or">
                     <operand locator="505:11-505:39" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="505:11-505:19" name="StartDate" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand locator="505:24-505:39" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="506:10-506:39" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="506:10-506:19" name="StatusDate" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand locator="506:24-506:39" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="507:10-507:60" xsi:type="Exists">
                     <operand locator="507:16-507:60" xsi:type="Query">
                        <source locator="507:17-507:30" alias="TD">
                           <expression locator="507:17-507:27" name="TargetDates" xsi:type="QueryLetRef"/>
                        </source>
                        <where locator="507:32-507:59" xsi:type="In">
                           <operand xsi:type="ToDateTime">
                              <operand locator="507:38-507:39" name="TD" xsi:type="AliasRef"/>
                           </operand>
                           <operand locator="507:44-507:59" name="LookBackInterval" xsi:type="QueryLetRef"/>
                        </where>
                     </operand>
                  </operand>
               </operand>
               <operand locator="508:10-508:79" xsi:type="Exists">
                  <operand locator="508:16-508:79" xsi:type="Query">
                     <source locator="508:17-508:35" alias="TQ">
                        <expression locator="508:17-508:32" name="TargetQuantities" xsi:type="QueryLetRef"/>
                     </source>
                     <where locator="508:37-508:78" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="508:43-508:58" xsi:type="Add">
                              <operand locator="508:44-508:52" name="StartDate" xsi:type="QueryLetRef"/>
                              <operand locator="508:56-508:57" name="TQ" xsi:type="AliasRef"/>
                           </operand>
                        </operand>
                        <operand locator="508:63-508:78" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </where>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="GoalList">
            <operandTypeSpecifier locator="498:39-498:48" xsi:type="ListTypeSpecifier">
               <elementType locator="498:44-498:47" name="fhir:Goal" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="498:60-498:74" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
   </statements>
</library>
